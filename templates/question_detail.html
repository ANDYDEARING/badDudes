{% extends "base.html" %}
{% load static %}


{% block head %}
<script src="{% static 'compiled.js' %}" defer></script>

{% endblock %}


{% block content %}

<div class="questionClass">
    <h1>{{ question.title }}</h1>
    <p>{{ question.content |safe }}</p>
    {% if request.user.is_authenticated %}
        {% if question_is_favorited %}
            <button id='q-fav-button' data-questionpk="{{ question.pk }}">Favorited (Click to Remove)</button>
        {% else %}
            <button id='q-fav-button' data-questionpk="{{ question.pk }}">Mark Question as Favorite</button>
        {% endif %}
          
        <button id="showFormButton">Add an answer</button>

            <form action="" method="POST" hidden="hidden" id="answerForm">
                {% csrf_token %}
                <br>
                <h5>Your Answer</h5>
                <textarea cols="40" rows="5" id="answerInput"></textarea>
                <br>
                <br>
                <button id="answerSubmit" data-questionpk="{{ question.pk }}">Submit</button>
            </form>

    {% else %}
        <p>You need to <a class="washed-blue" href="{% url 'account_login' %}">login to your account</a> in order to submit an answer.</p>
    {% endif %}
</div>

<div class="answerClass">
    <h2>Answers:</h2>

    {% if question.answer_set.all %}
    <div id="displayAnswers">
            {% for answer in question.answer_set.all %}
            <div id="individualAnswer">
                <hr>
                <p><strong>{{answer.content}}</strong> - {{answer.created_at}} by {{answer.author}} {% if question.correct_answer == answer %}<b>CORRECT ANSWER</b>{% endif %}</p>
                {% if request.user.is_authenticated %}
                    {% if answer.pk in favorited_answer_pk_list %}
                        <button class='a-fav-button' id="fav-{{ answer.pk }}" data-answerpk="{{ answer.pk }}">Favorited (Click to Remove)</button><br>
                    {% else %}
                        <button class='a-fav-button' id="fav-{{ answer.pk }}" data-answerpk="{{ answer.pk }}">Mark Answer as Favorite</button><br>
                    {% endif %}
                {% endif %}
                {% if question.author == request.user %}
                    {% if question.correct_answer != answer %}
                        <button class="makeCorrectLink" id="answer-{{ answer.pk }}" data-answerpk="{{ answer.pk }}" data-questionpk="{{ question.pk }}">Mark Answer as Correct</button>
                    {% else %}
                        <button class="makeCorrectLink" id="answer-{{ answer.pk }}" data-answerpk="{{ answer.pk }}" data-questionpk="{{ question.pk }}">CORRECT ANSWER (Click to remove)</button>
                    {% endif %}   
                {% endif %}
            {% endfor %}
                <hr>
            </div>
    {% else %}
        <p>There are no answers for this question.</p>
    {% endif %}
    </div>
</div>
{% endblock %}